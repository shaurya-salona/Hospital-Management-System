<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Patient Dashboard - HMIS</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #f8fafc;
                color: #334155;
            }

            .dashboard-container {
                display: flex;
                min-height: 100vh;
            }

            .sidebar {
                width: 280px;
                background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
                color: white;
                padding: 0;
                position: fixed;
                height: 100vh;
                overflow-y: auto;
                z-index: 1000;
            }

            .sidebar-header {
                padding: 30px 20px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .sidebar-header h1 {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }

            .sidebar-header p {
                opacity: 0.8;
                font-size: 0.9rem;
            }

            .sidebar-nav {
                padding: 20px 0;
            }

            .nav-item {
                margin: 5px 0;
            }

            .nav-link {
                display: flex;
                align-items: center;
                padding: 15px 20px;
                color: white;
                text-decoration: none;
                transition: all 0.3s ease;
                border-left: 3px solid transparent;
            }

            .nav-link:hover {
                background: rgba(255, 255, 255, 0.1);
                border-left-color: rgba(255, 255, 255, 0.3);
            }

            .nav-link.active {
                background: rgba(255, 255, 255, 0.15);
                border-left-color: white;
            }

            .nav-link i {
                margin-right: 12px;
                width: 20px;
                text-align: center;
            }

            .main-content {
                flex: 1;
                margin-left: 280px;
                padding: 0;
            }

            .top-bar {
                background: white;
                padding: 20px 30px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .user-info {
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .user-avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
            }

            .user-details h3 {
                font-size: 1rem;
                margin-bottom: 2px;
            }

            .user-details p {
                font-size: 0.8rem;
                color: #64748b;
            }

            .logout-btn {
                background: #ef4444;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 0.9rem;
                transition: background 0.3s ease;
            }

            .logout-btn:hover {
                background: #dc2626;
            }

            .dashboard-content {
                padding: 30px;
            }

            .welcome-section {
                background: white;
                border-radius: 12px;
                padding: 30px;
                margin-bottom: 30px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .welcome-section h2 {
                color: #8b5cf6;
                margin-bottom: 10px;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: white;
                border-radius: 12px;
                padding: 25px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease;
            }

            .stat-card:hover {
                transform: translateY(-2px);
            }

            .stat-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }

            .stat-title {
                font-size: 0.9rem;
                color: #64748b;
                font-weight: 500;
            }

            .stat-icon {
                width: 40px;
                height: 40px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1.2rem;
            }

            .stat-icon-purple {
                background: #8b5cf6;
            }

            .stat-icon-green {
                background: #10b981;
            }

            .stat-icon-orange {
                background: #f59e0b;
            }

            .stat-icon-red {
                background: #ef4444;
            }

            .stat-value {
                font-size: 2rem;
                font-weight: bold;
                color: #1e293b;
                margin-bottom: 5px;
            }

            .stat-change {
                font-size: 0.8rem;
                color: #8b5cf6;
            }

            .quick-actions {
                background: white;
                border-radius: 12px;
                padding: 30px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .quick-actions h3 {
                margin-bottom: 20px;
                color: #1e293b;
            }

            .actions-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .action-btn {
                background: #f8fafc;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                text-decoration: none;
                color: #334155;
            }

            .action-btn:hover {
                background: #8b5cf6;
                color: white;
                border-color: #8b5cf6;
            }

            .action-btn i {
                font-size: 2rem;
                margin-bottom: 10px;
                display: block;
            }

            .action-btn span {
                font-weight: 500;
            }

            /* Modal Styles */
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            }

            .modal {
                background: white;
                border-radius: 12px;
                padding: 30px;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                position: relative;
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 1px solid #e2e8f0;
            }

            .modal-header h3 {
                color: #1e293b;
                margin: 0;
            }

            .modal-close {
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: #64748b;
                padding: 5px;
            }

            .modal-close:hover {
                color: #ef4444;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                color: #374151;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                width: 100%;
                padding: 12px;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                font-size: 1rem;
                transition: border-color 0.3s ease;
            }

            .form-group input:focus,
            .form-group select:focus,
            .form-group textarea:focus {
                outline: none;
                border-color: #8b5cf6;
            }

            .form-actions {
                display: flex;
                gap: 10px;
                justify-content: flex-end;
                margin-top: 20px;
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn-primary {
                background: #8b5cf6;
                color: white;
            }

            .btn-primary:hover {
                background: #7c3aed;
            }

            .btn-secondary {
                background: #f3f4f6;
                color: #374151;
                border: 1px solid #d1d5db;
            }

            .btn-secondary:hover {
                background: #e5e7eb;
            }

            .data-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }

            .data-table th,
            .data-table td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #e2e8f0;
            }

            .data-table th {
                background: #f8fafc;
                font-weight: 600;
                color: #374151;
            }

            .data-table tr:hover {
                background: #f8fafc;
            }

            .status-badge {
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 0.8rem;
                font-weight: 500;
            }

            .status-scheduled {
                background: #dbeafe;
                color: #1e40af;
            }

            .status-completed {
                background: #d1fae5;
                color: #065f46;
            }

            .status-cancelled {
                background: #fee2e2;
                color: #991b1b;
            }

            .status-active {
                background: #d1fae5;
                color: #065f46;
            }

            .status-pending {
                background: #fef3c7;
                color: #92400e;
            }

            .status-paid {
                background: #d1fae5;
                color: #065f46;
            }

            .status-unpaid {
                background: #fee2e2;
                color: #991b1b;
            }

            .section-content {
                display: none;
            }

            .section-content.active {
                display: block;
            }

            .empty-state {
                text-align: center;
                padding: 40px;
                color: #64748b;
            }

            .empty-state i {
                font-size: 3rem;
                margin-bottom: 15px;
                opacity: 0.5;
            }
        </style>
    </head>

    <body>
        <div class="dashboard-container">
            <div class="sidebar">
                <div class="sidebar-header">
                    <h1><i class="fas fa-user-injured"></i> Patient</h1>
                    <p>Health Dashboard</p>
                </div>

                <nav class="sidebar-nav">
                    <div class="nav-item">
                        <a href="#" class="nav-link active" onclick="showSection('overview')">
                            <i class="fas fa-tachometer-alt"></i>
                            Overview
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('appointments')">
                            <i class="fas fa-calendar-check"></i>
                            Appointments
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('medical-records')">
                            <i class="fas fa-file-medical"></i>
                            Medical Records
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('prescriptions')">
                            <i class="fas fa-prescription-bottle-alt"></i>
                            Prescriptions
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('billing')">
                            <i class="fas fa-receipt"></i>
                            Billing
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('profile')">
                            <i class="fas fa-user-edit"></i>
                            Profile
                        </a>
                    </div>
                </nav>
            </div>

            <div class="main-content">
                <div class="top-bar">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">P</div>
                        <div class="user-details">
                            <h3 id="userName">Patient</h3>
                            <p id="userRole">Patient Portal</p>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>

                <div class="dashboard-content">
                    <!-- Overview Section -->
                    <div id="overview" class="section-content active">
                        <div class="welcome-section">
                            <h2>Welcome to Your Health Dashboard</h2>
                            <p>Manage your appointments, view medical records, and track your health information.</p>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-header">
                                    <span class="stat-title">Upcoming Appointments</span>
                                    <div class="stat-icon stat-icon-purple">
                                        <i class="fas fa-calendar-day"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="upcomingAppointments">2</div>
                                <div class="stat-change">Next: Tomorrow 10:00 AM</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-header">
                                    <span class="stat-title">Active Prescriptions</span>
                                    <div class="stat-icon stat-icon-green">
                                        <i class="fas fa-pills"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="activePrescriptions">3</div>
                                <div class="stat-change">All up to date</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-header">
                                    <span class="stat-title">Medical Records</span>
                                    <div class="stat-icon stat-icon-orange">
                                        <i class="fas fa-file-medical"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="medicalRecords">12</div>
                                <div class="stat-change">Last updated: 2 days ago</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-header">
                                    <span class="stat-title">Outstanding Balance</span>
                                    <div class="stat-icon stat-icon-red">
                                        <i class="fas fa-rupee-sign"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="outstandingBalance">₹12,000</div>
                                <div class="stat-change">Due: Next week</div>
                            </div>
                        </div>

                        <div class="quick-actions">
                            <h3>Quick Actions</h3>
                            <div class="actions-grid">
                                <a href="#" class="action-btn" onclick="showSection('appointments')">
                                    <i class="fas fa-calendar-plus"></i>
                                    <span>Book Appointment</span>
                                </a>
                                <a href="#" class="action-btn" onclick="showSection('medical-records')">
                                    <i class="fas fa-file-download"></i>
                                    <span>View Records</span>
                                </a>
                                <a href="#" class="action-btn" onclick="showSection('prescriptions')">
                                    <i class="fas fa-prescription-bottle-alt"></i>
                                    <span>Check Prescriptions</span>
                                </a>
                                <a href="#" class="action-btn" onclick="showSection('billing')">
                                    <i class="fas fa-credit-card"></i>
                                    <span>Make Payment</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Appointments Section -->
                    <div id="appointments" class="section-content">
                        <div class="welcome-section">
                            <h2>Appointments</h2>
                            <p>Manage your medical appointments and schedule new ones.</p>
                            <button class="btn btn-primary" onclick="showBookAppointmentModal()">
                                <i class="fas fa-plus"></i> Book New Appointment
                            </button>
                        </div>
                        <div id="appointmentsTable">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date & Time</th>
                                        <th>Doctor</th>
                                        <th>Department</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="appointmentsTableBody">
                                    <!-- Appointments will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Medical Records Section -->
                    <div id="medical-records" class="section-content">
                        <div class="welcome-section">
                            <h2>Medical Records</h2>
                            <p>View and download your medical history and test results.</p>
                        </div>
                        <div id="medicalRecordsTable">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Doctor</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="medicalRecordsTableBody">
                                    <!-- Medical records will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Prescriptions Section -->
                    <div id="prescriptions" class="section-content">
                        <div class="welcome-section">
                            <h2>Prescriptions</h2>
                            <p>View your current and past prescriptions.</p>
                        </div>
                        <div id="prescriptionsTable">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Medication</th>
                                        <th>Dosage</th>
                                        <th>Quantity</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="prescriptionsTableBody">
                                    <!-- Prescriptions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Billing Section -->
                    <div id="billing" class="section-content">
                        <div class="welcome-section">
                            <h2>Billing & Payments</h2>
                            <p>View your bills and make payments online.</p>
                        </div>
                        <div id="billingTable">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Bill Date</th>
                                        <th>Service</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="billingTableBody">
                                    <!-- Billing records will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Profile Section -->
                    <div id="profile" class="section-content">
                        <div class="welcome-section">
                            <h2>Profile Settings</h2>
                            <p>Update your personal information and preferences.</p>
                        </div>
                        <div id="profileForm">
                            <form id="profileUpdateForm">
                                <div class="form-group">
                                    <label for="firstName">First Name</label>
                                    <input type="text" id="firstName" name="firstName" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Last Name</label>
                                    <input type="text" id="lastName" name="lastName" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="email" required>
                                </div>
                                <div class="form-group">
                                    <label for="phone">Phone</label>
                                    <input type="tel" id="phone" name="phone" required>
                                </div>
                                <div class="form-group">
                                    <label for="address">Address</label>
                                    <textarea id="address" name="address" rows="3"></textarea>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">Update Profile</button>
                                    <button type="button" class="btn btn-secondary"
                                        onclick="loadProfileData()">Reset</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Overlay -->
        <div id="modalOverlay" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3 id="modalTitle">Modal Title</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div id="modalContent">
                    <!-- Modal content will be loaded here -->
                </div>
            </div>
        </div>

        <script src="auth-service.js"></script>
        <script src="patient-dashboard.js"></script>
        <script>
            // Sample data with rupee amounts
            const sampleData = {
                appointments: [
                    { id: 1, date: '2024-09-20', time: '10:00 AM', doctor: 'Dr. Sarah Johnson', department: 'Cardiology', status: 'scheduled' },
                    { id: 2, date: '2024-09-25', time: '2:30 PM', doctor: 'Dr. Michael Chen', department: 'General Medicine', status: 'scheduled' },
                    { id: 3, date: '2024-09-15', time: '9:00 AM', doctor: 'Dr. Emily Davis', department: 'Dermatology', status: 'completed' }
                ],
                medicalRecords: [
                    { id: 1, date: '2024-09-15', type: 'Blood Test', doctor: 'Dr. Sarah Johnson', description: 'Complete Blood Count (CBC) - Normal results' },
                    { id: 2, date: '2024-09-10', type: 'X-Ray', doctor: 'Dr. Michael Chen', description: 'Chest X-Ray - Clear lungs' },
                    { id: 3, date: '2024-09-05', type: 'Physical Exam', doctor: 'Dr. Emily Davis', description: 'Annual physical examination' }
                ],
                prescriptions: [
                    { id: 1, medication: 'Lisinopril', dosage: '10mg', quantity: 30, startDate: '2024-09-01', endDate: '2024-09-30', status: 'active' },
                    { id: 2, medication: 'Metformin', dosage: '500mg', quantity: 60, startDate: '2024-08-15', endDate: '2024-10-15', status: 'active' },
                    { id: 3, medication: 'Ibuprofen', dosage: '400mg', quantity: 20, startDate: '2024-09-10', endDate: '2024-09-20', status: 'completed' }
                ],
                billing: [
                    { id: 1, date: '2024-09-15', service: 'Consultation', amount: 1200, status: 'unpaid' },
                    { id: 2, date: '2024-09-10', service: 'Blood Test', amount: 600, status: 'paid' },
                    { id: 3, date: '2024-09-05', service: 'X-Ray', amount: 1600, status: 'unpaid' }
                ]
            };

            // Initialize dashboard
            document.addEventListener('DOMContentLoaded', function () {
                initializeDashboard();
            });

            function initializeDashboard() {
                if (!authService.isAuthenticated()) {
                    authService.showNotification('Please login to access the dashboard', 'error');
                    setTimeout(() => {
                        window.location.href = 'patient-login.html';
                    }, 2000);
                    return;
                }
                loadUserData();
                loadDashboardData();
                loadAppointments();
                loadMedicalRecords();
                loadPrescriptions();
                loadBilling();
                loadProfileData();
            }

            function loadUserData() {
                const user = authService.getCurrentUser();
                if (user) {
                    document.getElementById('userName').textContent = `${user.first_name} ${user.last_name}`;
                    document.getElementById('userRole').textContent = 'Patient Portal';
                    document.getElementById('userAvatar').textContent = user.first_name.charAt(0);
                }
            }

            function loadDashboardData() {
                document.getElementById('upcomingAppointments').textContent =
                    sampleData.appointments.filter(apt => apt.status === 'scheduled').length;
                document.getElementById('activePrescriptions').textContent =
                    sampleData.prescriptions.filter(pres => pres.status === 'active').length;
                document.getElementById('medicalRecords').textContent = sampleData.medicalRecords.length;

                const unpaidAmount = sampleData.billing
                    .filter(bill => bill.status === 'unpaid')
                    .reduce((sum, bill) => sum + bill.amount, 0);
                document.getElementById('outstandingBalance').textContent = `₹${unpaidAmount.toLocaleString()}`;
            }

            function showSection(section) {
                document.querySelectorAll('.section-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(section).classList.add('active');
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                event.target.closest('.nav-link').classList.add('active');
            }

            function loadAppointments() {
                const tbody = document.getElementById('appointmentsTableBody');
                tbody.innerHTML = sampleData.appointments.map(appointment => `
                <tr>
                    <td>${appointment.date} at ${appointment.time}</td>
                    <td>${appointment.doctor}</td>
                    <td>${appointment.department}</td>
                    <td><span class="status-badge status-${appointment.status}">${appointment.status}</span></td>
                    <td>
                        <button class="btn btn-secondary" onclick="viewAppointment(${appointment.id})">View</button>
                        ${appointment.status === 'scheduled' ?
                        `<button class="btn btn-secondary" onclick="cancelAppointment(${appointment.id})">Cancel</button>` :
                        ''
                    }
                    </td>
                </tr>
            `).join('');
            }

            function showBookAppointmentModal() {
                const modalContent = `
                <form id="bookAppointmentForm">
                    <div class="form-group">
                        <label for="appointmentDate">Date</label>
                        <input type="date" id="appointmentDate" name="date" required>
                        </div>
                    <div class="form-group">
                        <label for="appointmentTime">Time</label>
                        <select id="appointmentTime" name="time" required>
                            <option value="">Select Time</option>
                            <option value="9:00 AM">9:00 AM</option>
                            <option value="10:00 AM">10:00 AM</option>
                            <option value="11:00 AM">11:00 AM</option>
                            <option value="2:00 PM">2:00 PM</option>
                            <option value="3:00 PM">3:00 PM</option>
                            <option value="4:00 PM">4:00 PM</option>
                        </select>
                        </div>
                    <div class="form-group">
                        <label for="appointmentDoctor">Doctor</label>
                        <select id="appointmentDoctor" name="doctor" required>
                            <option value="">Select Doctor</option>
                            <option value="Dr. Sarah Johnson">Dr. Sarah Johnson - Cardiology</option>
                            <option value="Dr. Michael Chen">Dr. Michael Chen - General Medicine</option>
                            <option value="Dr. Emily Davis">Dr. Emily Davis - Dermatology</option>
                        </select>
                        </div>
                    <div class="form-group">
                        <label for="appointmentReason">Reason for Visit</label>
                        <textarea id="appointmentReason" name="reason" rows="3" required></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Book Appointment</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        </div>
                </form>
            `;
                showModal('Book New Appointment', modalContent);
                document.getElementById('appointmentDate').min = new Date().toISOString().split('T')[0];

                document.getElementById('bookAppointmentForm').addEventListener('submit', function (e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const newAppointment = {
                        id: sampleData.appointments.length + 1,
                        date: formData.get('date'),
                        time: formData.get('time'),
                        doctor: formData.get('doctor'),
                        department: formData.get('doctor').split(' - ')[1],
                        status: 'scheduled'
                    };
                    sampleData.appointments.push(newAppointment);
                    loadAppointments();
                    loadDashboardData();
                    closeModal();
                    authService.showNotification('Appointment booked successfully!', 'success');
                });
            }

            function viewAppointment(id) {
                const appointment = sampleData.appointments.find(apt => apt.id === id);
                const modalContent = `
                <div>
                    <p><strong>Date:</strong> ${appointment.date}</p>
                    <p><strong>Time:</strong> ${appointment.time}</p>
                    <p><strong>Doctor:</strong> ${appointment.doctor}</p>
                    <p><strong>Department:</strong> ${appointment.department}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-${appointment.status}">${appointment.status}</span></p>
                        </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                    </div>
                `;
                showModal('Appointment Details', modalContent);
            }

            function cancelAppointment(id) {
                if (confirm('Are you sure you want to cancel this appointment?')) {
                    const appointment = sampleData.appointments.find(apt => apt.id === id);
                    appointment.status = 'cancelled';
                    loadAppointments();
                    loadDashboardData();
                    authService.showNotification('Appointment cancelled successfully!', 'success');
                }
            }

            function loadMedicalRecords() {
                const tbody = document.getElementById('medicalRecordsTableBody');
                tbody.innerHTML = sampleData.medicalRecords.map(record => `
                <tr>
                    <td>${record.date}</td>
                    <td>${record.type}</td>
                    <td>${record.doctor}</td>
                    <td>${record.description}</td>
                    <td>
                        <button class="btn btn-primary" onclick="downloadRecord(${record.id})">Download</button>
                        <button class="btn btn-secondary" onclick="viewRecord(${record.id})">View</button>
                        </td>
                    </tr>
            `).join('');
            }

            function viewRecord(id) {
                const record = sampleData.medicalRecords.find(rec => rec.id === id);
                const modalContent = `
                <div>
                    <p><strong>Date:</strong> ${record.date}</p>
                    <p><strong>Type:</strong> ${record.type}</p>
                    <p><strong>Doctor:</strong> ${record.doctor}</p>
                    <p><strong>Description:</strong> ${record.description}</p>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="downloadRecord(${record.id})">Download PDF</button>
                    <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                </div>
            `;
                showModal('Medical Record Details', modalContent);
            }

            function downloadRecord(id) {
                authService.showNotification('Download started...', 'success');
            }

            function loadPrescriptions() {
                const tbody = document.getElementById('prescriptionsTableBody');
                tbody.innerHTML = sampleData.prescriptions.map(prescription => `
                <tr>
                    <td>${prescription.medication}</td>
                    <td>${prescription.dosage}</td>
                    <td>${prescription.quantity}</td>
                    <td>${prescription.startDate}</td>
                    <td>${prescription.endDate}</td>
                    <td><span class="status-badge status-${prescription.status}">${prescription.status}</span></td>
                    </tr>
            `).join('');
            }

            function loadBilling() {
                const tbody = document.getElementById('billingTableBody');
                tbody.innerHTML = sampleData.billing.map(bill => `
                <tr>
                    <td>${bill.date}</td>
                    <td>${bill.service}</td>
                    <td>₹${bill.amount.toLocaleString()}</td>
                    <td><span class="status-badge status-${bill.status}">${bill.status}</span></td>
                    <td>
                        ${bill.status === 'unpaid' ?
                        `<button class="btn btn-primary" onclick="makePayment(${bill.id})">Pay Now</button>` :
                        '<span class="status-badge status-paid">Paid</span>'
                    }
                        <button class="btn btn-secondary" onclick="viewBill(${bill.id})">View</button>
                        </td>
                    </tr>
            `).join('');
            }

            function makePayment(id) {
                const bill = sampleData.billing.find(b => b.id === id);
                const modalContent = `
                <div>
                    <p><strong>Service:</strong> ${bill.service}</p>
                    <p><strong>Amount:</strong> ₹${bill.amount.toLocaleString()}</p>
                    <p><strong>Date:</strong> ${bill.date}</p>
                </div>
                <form id="paymentForm">
                    <div class="form-group">
                        <label for="paymentMethod">Payment Method</label>
                        <select id="paymentMethod" name="method" required>
                            <option value="">Select Payment Method</option>
                            <option value="credit">Credit Card</option>
                            <option value="debit">Debit Card</option>
                            <option value="bank">Bank Transfer</option>
                            <option value="upi">UPI</option>
                            <option value="netbanking">Net Banking</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Process Payment</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
                showModal('Make Payment', modalContent);

                document.getElementById('paymentForm').addEventListener('submit', function (e) {
                    e.preventDefault();
                    bill.status = 'paid';
                    loadBilling();
                    loadDashboardData();
                    closeModal();
                    authService.showNotification('Payment processed successfully!', 'success');
                });
            }

            function viewBill(id) {
                const bill = sampleData.billing.find(b => b.id === id);
                const modalContent = `
                <div>
                    <p><strong>Date:</strong> ${bill.date}</p>
                    <p><strong>Service:</strong> ${bill.service}</p>
                    <p><strong>Amount:</strong> ₹${bill.amount.toLocaleString()}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-${bill.status}">${bill.status}</span></p>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                </div>
            `;
                showModal('Bill Details', modalContent);
            }

            function loadProfileData() {
                const user = authService.getCurrentUser();
                if (user) {
                    document.getElementById('firstName').value = user.first_name || '';
                    document.getElementById('lastName').value = user.last_name || '';
                    document.getElementById('email').value = user.email || '';
                    document.getElementById('phone').value = user.phone || '';
                    document.getElementById('address').value = user.address || '';
                }
            }

            function showModal(title, content) {
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('modalContent').innerHTML = content;
                document.getElementById('modalOverlay').style.display = 'flex';
            }

            function closeModal() {
                document.getElementById('modalOverlay').style.display = 'none';
            }

            document.getElementById('modalOverlay').addEventListener('click', function (e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            function logout() {
                if (confirm('Are you sure you want to logout?')) {
                    authService.logout();
                }
            }

            // Profile form event listener
            document.addEventListener('DOMContentLoaded', function () {
                const profileForm = document.getElementById('profileUpdateForm');
                if (profileForm) {
                    profileForm.addEventListener('submit', function (e) {
                        e.preventDefault();
                        const formData = new FormData(e.target);

                        const user = authService.getCurrentUser();
                        if (user) {
                            user.first_name = formData.get('firstName');
                            user.last_name = formData.get('lastName');
                            user.email = formData.get('email');
                            user.phone = formData.get('phone');
                            user.address = formData.get('address');

                            localStorage.setItem('userData', JSON.stringify(user));
                            loadUserData();
                            authService.showNotification('Profile updated successfully!', 'success');
                        }
                    });
                }
            });
        </script>
    </body>

</html>
